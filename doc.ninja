# This build file must be run in the lib/bs/ directory
# Run with: npx bsb -- -C lib/bs -f doc.ninja

odoc = odoc
package = api
input_dir = src
output_dir = ../../docs
includes =
syntax = re

rule odoc
  command = $odoc compile $includes --package=$package $in
  description = odoc compile $in

rule html
  command = $odoc html --syntax=$syntax $includes --output-dir=$output_dir $in
  description = odoc html $in

rule support_files
  command = $odoc support-files --output-dir=$output_dir
  description = odoc support-files

# The outputs should come from 'odoc support-files-targs -o docs'
build $
  $output_dir/odoc.css $
  $output_dir/highlight.pack.js: support_files

build $input_dir/Webapi.odoc: odoc $input_dir/Webapi.cmt | $
  $input_dir/Webapi/Webapi__Url.odoc $
  $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.odoc $
  $input_dir/Webapi/Webapi__ResizeObserver.odoc $
  $input_dir/Webapi/Webapi__Performance.odoc $
  $input_dir/Webapi/Webapi__File.odoc $
  $input_dir/Webapi/Dom/Webapi__Dom__Window.odoc
  includes = $
    -I $input_dir $
    -I $input_dir/Webapi $
    -I $input_dir/Webapi/ResizeObserver $
    -I $input_dir/Webapi/Dom
build $output_dir/$package/Webapi/index.html: html $input_dir/Webapi.odoc | $
  $input_dir/Webapi/Webapi__Url.odoc $
  $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.odoc $
  $input_dir/Webapi/Webapi__ResizeObserver.odoc $
  $input_dir/Webapi/Webapi__Performance.odoc $
  $input_dir/Webapi/Webapi__File.odoc $
  $input_dir/Webapi/Dom/Webapi__Dom__Window.odoc
  includes = $
    -I $input_dir $
    -I $input_dir/Webapi $
    -I $input_dir/Webapi/ResizeObserver $
    -I $input_dir/Webapi/Dom

build $input_dir/Webapi/Webapi__Url.odoc: odoc $input_dir/Webapi/Webapi__Url.cmt | $
  $input_dir/Webapi/Webapi__File.odoc
  includes = $
    -I $input_dir/Webapi
build $
  $output_dir/$package/Webapi/Url/index.html $
  $output_dir/$package/Webapi__Url/index.html: html $input_dir/Webapi/Webapi__Url.odoc | $
  $input_dir/Webapi/Webapi__File.odoc
  includes = $
    -I $input_dir/Webapi

build $input_dir/Webapi/Webapi__File.odoc: odoc $input_dir/Webapi/Webapi__File.cmt
build $
  $output_dir/$package/Webapi/File/index.html $
  $output_dir/$package/Webapi__File/index.html: html $input_dir/Webapi/Webapi__File.odoc

build $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.odoc: odoc $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.cmt
build $
  $output_dir/$package/Webapi/ResizeObserver/ResizeObserverEntry/index.html $
  $output_dir/$package/Webapi__ResizeObserver__ResizeObserverEntry/index.html: html $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.odoc

build $input_dir/Webapi/Webapi__ResizeObserver.odoc: odoc $input_dir/Webapi/Webapi__ResizeObserver.cmt | $
  $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.odoc
  includes = $
    -I $input_dir/Webapi/ResizeObserver
build $
  $output_dir/$package/Webapi/ResizeObserver/index.html $
  $output_dir/$package/Webapi__ResizeObserver/index.html: html $input_dir/Webapi/Webapi__ResizeObserver.odoc | $
  $input_dir/Webapi/ResizeObserver/Webapi__ResizeObserver__ResizeObserverEntry.odoc
  includes = $
    -I $input_dir/Webapi/ResizeObserver

build $input_dir/Webapi/Webapi__Performance.odoc: odoc $input_dir/Webapi/Webapi__Performance.cmt
build $
  $output_dir/$package/Webapi/Performance/index.html $
  $output_dir/$package/Webapi__Performance/index.html: html $input_dir/Webapi/Webapi__Performance.odoc

build $input_dir/Webapi/Dom/Webapi__Dom__Window.odoc: odoc $input_dir/Webapi/Dom/Webapi__Dom__Window.cmt | $
  $input_dir/Webapi/Webapi__Performance.odoc $
  $input_dir/Webapi/Dom/Webapi__Dom__GlobalEventHandlers.odoc $
  $input_dir/Webapi/Dom/Webapi__Dom__EventTarget.odoc
  includes = $
    -I $input_dir/Webapi $
    -I $input_dir/Webapi/Dom
build $
  $output_dir/$package/Webapi/Dom/Window/index.html $
  $output_dir/$package/Webapi__Dom__Window/index.html: html $input_dir/Webapi/Dom/Webapi__Dom__Window.odoc | $
  $input_dir/Webapi/Webapi__Performance.odoc $
  $input_dir/Webapi/Dom/Webapi__Dom__GlobalEventHandlers.odoc $
  $input_dir/Webapi/Dom/Webapi__Dom__EventTarget.odoc
  includes = $
    -I $input_dir/Webapi $
    -I $input_dir/Webapi/Dom

build $input_dir/Webapi/Dom/Webapi__Dom__GlobalEventHandlers.odoc: odoc $input_dir/Webapi/Dom/Webapi__Dom__GlobalEventHandlers.cmt
build $
  $output_dir/$package/Webapi/Dom/GlobalEventHandlers/index.html $
  $output_dir/$package/Webapi__Dom__GlobalEventHandlers/index.html: html $input_dir/Webapi/Dom/Webapi__Dom__GlobalEventHandlers.odoc

build $input_dir/Webapi/Dom/Webapi__Dom__EventTarget.odoc: odoc $input_dir/Webapi/Dom/Webapi__Dom__EventTarget.cmt
build $
  $output_dir/$package/Webapi/Dom/EventTarget/index.html $
  $output_dir/$package/Webapi__Dom__EventTarget/index.html: html $input_dir/Webapi/Dom/Webapi__Dom__EventTarget.odoc

